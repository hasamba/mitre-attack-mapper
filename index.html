<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MITRE ATT&CK Technique Mapper</title>
    <meta name="description" content="Map textual attack descriptions to MITRE ATT&CK techniques instantly">
    <meta name="keywords" content="MITRE ATT&CK, cybersecurity, threat intelligence, DFIR, SOC">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0c1426 0%, #1a1f3a 100%);
            color: #e2e8f0;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: grid;
            grid-template-rows: auto 1fr auto;
            gap: 20px;
        }

        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid #2d3748;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #63b3ed;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(99, 179, 237, 0.3);
        }

        .header p {
            font-size: 1.2rem;
            color: #a0aec0;
            max-width: 600px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
            align-items: start;
        }

        .input-section {
            background: rgba(45, 55, 72, 0.8);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid #4a5568;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .input-section h2 {
            color: #63b3ed;
            margin-bottom: 20px;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .textarea-container {
            position: relative;
            margin-bottom: 20px;
        }

        #attackDescription {
            width: 100%;
            min-height: 200px;
            background: #1a202c;
            border: 2px solid #4a5568;
            border-radius: 8px;
            padding: 15px;
            color: #e2e8f0;
            font-size: 16px;
            line-height: 1.5;
            resize: vertical;
            font-family: 'Consolas', 'Monaco', monospace;
            transition: all 0.3s ease;
        }

        #attackDescription:focus {
            outline: none;
            border-color: #63b3ed;
            box-shadow: 0 0 0 3px rgba(99, 179, 237, 0.1);
        }

        #attackDescription::placeholder {
            color: #718096;
        }

        .char-counter {
            position: absolute;
            bottom: -25px;
            right: 0;
            font-size: 12px;
            color: #718096;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background: linear-gradient(135deg, #3182ce 0%, #2c5282 100%);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(65, 153, 225, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #2f855a 0%, #276749 100%);
            box-shadow: 0 5px 15px rgba(56, 161, 105, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c53030 0%, #9c2727 100%);
            box-shadow: 0 5px 15px rgba(229, 62, 62, 0.3);
        }

        .results-section {
            background: rgba(45, 55, 72, 0.8);
            border-radius: 12px;
            padding: 30px;
            border: 1px solid #4a5568;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-height: 80vh;
            overflow-y: auto;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #4a5568;
        }

        .results-title {
            color: #63b3ed;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .results-count {
            background: #4a5568;
            color: #e2e8f0;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .technique-card {
            background: #1a202c;
            border: 1px solid #4a5568;
            border-radius: 8px;
            margin-bottom: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .technique-card:hover {
            border-color: #63b3ed;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }

        .technique-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .technique-id {
            background: #4a5568;
            color: #e2e8f0;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-weight: 600;
            font-size: 12px;
        }

        .confidence-score {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-left: auto;
        }

        .confidence-high {
            background: #38a169;
            color: white;
        }

        .confidence-medium {
            background: #d69e2e;
            color: white;
        }

        .confidence-low {
            background: #e53e3e;
            color: white;
        }

        .technique-name {
            color: #63b3ed;
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .technique-tactic {
            color: #a0aec0;
            font-size: 14px;
            margin-bottom: 10px;
            font-style: italic;
        }

        .technique-description {
            color: #cbd5e0;
            font-size: 14px;
            line-height: 1.5;
        }

        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: #718096;
        }

        .no-results .icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .export-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #4a5568;
        }

        .export-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .footer {
            text-align: center;
            padding: 20px 0;
            border-top: 1px solid #2d3748;
            color: #718096;
            font-size: 14px;
        }

        .footer a {
            color: #63b3ed;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Loading spinner */
        .spinner {
            border: 3px solid #4a5568;
            border-top: 3px solid #63b3ed;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .input-section, .results-section {
                padding: 20px;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn {
                justify-content: center;
            }
        }

        /* Syntax highlighting for matched keywords */
        .highlighted {
            background: rgba(99, 179, 237, 0.2);
            border-radius: 3px;
            padding: 1px 3px;
        }

        /* Animation for results appearing */
        .technique-card {
            opacity: 0;
            animation: fadeInUp 0.5s ease forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>MITRE ATT&CK Technique Mapper</h1>
            <p>Map textual attack descriptions to MITRE ATT&CK techniques instantly</p>
        </header>

        <main class="main-content">
            <section class="input-section">
                <h2>üìù Attack Description</h2>
                <div class="textarea-container">
                    <textarea 
                        id="attackDescription" 
                        placeholder="Paste your attack description here...

Example: &quot;The attacker used PowerShell to download a malicious payload from a C2 server, then established persistence through a scheduled task and harvested credentials using Mimikatz.&quot;"
                        maxlength="10000"
                    ></textarea>
                    <div class="char-counter">
                        <span id="charCount">0</span> / 10,000
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn" id="analyzeBtn">
                        üîç Analyze Attack
                    </button>
                    <button class="btn btn-secondary" id="exampleBtn">
                        üìã Load Example
                    </button>
                    <button class="btn btn-danger" id="clearBtn">
                        üóëÔ∏è Clear
                    </button>
                </div>
            </section>

            <section class="results-section">
                <div class="results-header">
                    <h2 class="results-title">üéØ Mapped Techniques</h2>
                    <span class="results-count" id="resultsCount">0 results</span>
                </div>
                
                <div id="resultsContainer">
                    <div class="no-results">
                        <div class="icon">üîç</div>
                        <p>Enter an attack description to see mapped MITRE ATT&CK techniques</p>
                    </div>
                </div>

                <div class="export-section">
                    <h3 style="color: #63b3ed; margin-bottom: 15px; font-size: 1.1rem;">üì§ Export Results</h3>
                    <div class="export-controls">
                        <button class="btn btn-secondary" id="copyJsonBtn" disabled>
                            üìã Copy JSON
                        </button>
                        <button class="btn btn-secondary" id="downloadJsonBtn" disabled>
                            üíæ Download JSON
                        </button>
                        <button class="btn btn-secondary" id="printBtn" disabled>
                            üñ®Ô∏è Print Report
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <footer class="footer">
            <p>
                Built with ‚ù§Ô∏è for the cybersecurity community | 
                Data based on <a href="https://attack.mitre.org/" target="_blank">MITRE ATT&CK Framework</a> |
                <a href="https://github.com/hasamba" target="_blank">GitHub</a>
            </p>
        </footer>
    </div>

    <script>
        // MITRE ATT&CK techniques database with keyword mappings
        const attackTechniques = [
            {
                id: "T1059.001",
                name: "PowerShell",
                tactic: "Execution",
                description: "Adversaries may abuse PowerShell commands and scripts for execution.",
                keywords: ["powershell", "ps1", "invoke-expression", "iex", "encoded command", "base64", "powershell.exe"]
            },
            {
                id: "T1105",
                name: "Ingress Tool Transfer",
                tactic: "Command and Control",
                description: "Adversaries may transfer tools or other files from an external system into a compromised environment.",
                keywords: ["download", "wget", "curl", "certutil", "bitsadmin", "transfer", "c2", "payload", "dropper"]
            },
            {
                id: "T1053",
                name: "Scheduled Task/Job",
                tactic: "Persistence",
                description: "Adversaries may abuse task scheduling functionality to facilitate initial or recurring execution of malicious code.",
                keywords: ["scheduled task", "schtasks", "cron", "at command", "job", "task scheduler", "persistence"]
            },
            {
                id: "T1003.001",
                name: "LSASS Memory",
                tactic: "Credential Access",
                description: "Adversaries may attempt to access credential material stored in the process memory of the Local Security Authority Subsystem Service (LSASS).",
                keywords: ["mimikatz", "lsass", "credentials", "sekurlsa", "lsadump", "memory dump", "credential harvesting"]
            },
            {
                id: "T1055",
                name: "Process Injection",
                tactic: "Defense Evasion",
                description: "Adversaries may inject code into processes in order to evade process-based defenses.",
                keywords: ["process injection", "dll injection", "code injection", "reflective dll", "process hollowing"]
            },
            {
                id: "T1071.001",
                name: "Web Protocols",
                tactic: "Command and Control",
                description: "Adversaries may communicate using application layer protocols associated with web traffic.",
                keywords: ["http", "https", "web traffic", "user-agent", "web protocol", "http beacon"]
            },
            {
                id: "T1027",
                name: "Obfuscated Files or Information",
                tactic: "Defense Evasion",
                description: "Adversaries may attempt to make an executable or file difficult to discover or analyze.",
                keywords: ["obfuscation", "encoded", "encrypted", "base64", "packed", "compressed", "steganography"]
            },
            {
                id: "T1082",
                name: "System Information Discovery",
                tactic: "Discovery",
                description: "An adversary may attempt to get detailed information about the operating system and hardware.",
                keywords: ["systeminfo", "hostname", "whoami", "system information", "reconnaissance", "discovery"]
            },
            {
                id: "T1083",
                name: "File and Directory Discovery",
                tactic: "Discovery",
                description: "Adversaries may enumerate files and directories or may search in specific locations of a host or network share.",
                keywords: ["dir", "ls", "find", "file discovery", "directory listing", "enumeration"]
            },
            {
                id: "T1057",
                name: "Process Discovery",
                tactic: "Discovery",
                description: "Adversaries may attempt to get information about running processes on a system.",
                keywords: ["tasklist", "ps", "process discovery", "running processes", "process enumeration"]
            },
            {
                id: "T1016",
                name: "System Network Configuration Discovery",
                tactic: "Discovery",
                description: "Adversaries may look for details about the network configuration and settings of systems.",
                keywords: ["ipconfig", "ifconfig", "netstat", "network configuration", "network discovery"]
            },
            {
                id: "T1033",
                name: "System Owner/User Discovery",
                tactic: "Discovery",
                description: "Adversaries may attempt to identify the primary user, currently logged in user, set of users that commonly uses a system.",
                keywords: ["whoami", "query user", "user discovery", "logged in users", "user enumeration"]
            },
            {
                id: "T1049",
                name: "System Network Connections Discovery",
                tactic: "Discovery",
                description: "Adversaries may attempt to get a listing of network connections to or from the compromised system.",
                keywords: ["netstat", "network connections", "active connections", "listening ports"]
            },
            {
                id: "T1018",
                name: "Remote System Discovery",
                tactic: "Discovery",
                description: "Adversaries may attempt to get a listing of other systems by IP address, hostname, or other logical identifier.",
                keywords: ["ping", "net view", "remote systems", "network scanning", "arp"]
            },
            {
                id: "T1021.001",
                name: "Remote Desktop Protocol",
                tactic: "Lateral Movement",
                description: "Adversaries may use Valid Accounts to log into a computer using the Remote Desktop Protocol (RDP).",
                keywords: ["rdp", "remote desktop", "mstsc", "terminal services", "3389"]
            },
            {
                id: "T1021.002",
                name: "SMB/Windows Admin Shares",
                tactic: "Lateral Movement",
                description: "Adversaries may use Valid Accounts to interact with a remote network share using Server Message Block (SMB).",
                keywords: ["smb", "admin shares", "c$", "psexec", "wmiexec", "445"]
            },
            {
                id: "T1078",
                name: "Valid Accounts",
                tactic: "Defense Evasion",
                description: "Adversaries may obtain and abuse credentials of existing accounts as a means of gaining Initial Access.",
                keywords: ["valid accounts", "compromised credentials", "stolen credentials", "account abuse"]
            },
            {
                id: "T1547.001",
                name: "Registry Run Keys / Startup Folder",
                tactic: "Persistence",
                description: "Adversaries may achieve persistence by adding a program to a startup folder or referencing it with a Registry run key.",
                keywords: ["registry", "run keys", "startup folder", "autostart", "hkcu", "hklm"]
            },
            {
                id: "T1543.003",
                name: "Windows Service",
                tactic: "Persistence",
                description: "Adversaries may create or modify Windows services to repeatedly execute malicious payloads.",
                keywords: ["windows service", "sc", "service", "services.exe", "service creation"]
            },
            {
                id: "T1112",
                name: "Modify Registry",
                tactic: "Defense Evasion",
                description: "Adversaries may interact with the Windows Registry to hide configuration information.",
                keywords: ["registry", "reg", "regedit", "registry modification", "hkey"]
            },
            {
                id: "T1090",
                name: "Proxy",
                tactic: "Command and Control",
                description: "Adversaries may use a connection proxy to direct network traffic between systems.",
                keywords: ["proxy", "socks", "tunneling", "connection proxy", "traffic redirection"]
            },
            {
                id: "T1056.001",
                name: "Keylogging",
                tactic: "Collection",
                description: "Adversaries may log user keystrokes to intercept credentials as the user types them.",
                keywords: ["keylogger", "keylogging", "keystroke", "keyboard capture", "credential capture"]
            },
            {
                id: "T1041",
                name: "Exfiltration Over C2 Channel",
                tactic: "Exfiltration",
                description: "Adversaries may steal data by exfiltrating it over an existing command and control channel.",
                keywords: ["exfiltration", "data theft", "c2 channel", "data exfil", "stolen data"]
            },
            {
                id: "T1486",
                name: "Data Encrypted for Impact",
                tactic: "Impact",
                description: "Adversaries may encrypt data on target systems or on large numbers of systems in a network to interrupt availability.",
                keywords: ["ransomware", "encryption", "encrypted files", "data encryption", "crypto"]
            },
            {
                id: "T1070.004",
                name: "File Deletion",
                tactic: "Defense Evasion",
                description: "Adversaries may delete files left behind by the actions of their intrusion activity.",
                keywords: ["file deletion", "del", "rm", "sdelete", "log deletion", "artifact removal"]
            },
            {
                id: "T1036",
                name: "Masquerading",
                tactic: "Defense Evasion",
                description: "Adversaries may attempt to manipulate features of their artifacts to make them appear legitimate.",
                keywords: ["masquerading", "fake", "legitimate", "disguise", "impersonation", "spoofing"]
            },
            {
                id: "T1204.002",
                name: "Malicious File",
                tactic: "Execution",
                description: "An adversary may rely upon a user opening a malicious file in order to gain execution.",
                keywords: ["malicious file", "user execution", "email attachment", "document", "macro"]
            },
            {
                id: "T1566.001",
                name: "Spearphishing Attachment",
                tactic: "Initial Access",
                description: "Adversaries may send spearphishing emails with a malicious attachment.",
                keywords: ["phishing", "spearphishing", "email attachment", "malicious attachment", "phishing email"]
            },
            {
                id: "T1190",
                name: "Exploit Public-Facing Application",
                tactic: "Initial Access",
                description: "Adversaries may attempt to take advantage of a weakness in an Internet-facing computer or program.",
                keywords: ["exploit", "vulnerability", "public-facing", "web application", "remote exploit"]
            }
        ];

        // Global variables
        let currentResults = [];
        let isAnalyzing = false;

        // DOM elements
        const attackDescription = document.getElementById('attackDescription');
        const charCount = document.getElementById('charCount');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const exampleBtn = document.getElementById('exampleBtn');
        const clearBtn = document.getElementById('clearBtn');
        const resultsContainer = document.getElementById('resultsContainer');
        const resultsCount = document.getElementById('resultsCount');
        const copyJsonBtn = document.getElementById('copyJsonBtn');
        const downloadJsonBtn = document.getElementById('downloadJsonBtn');
        const printBtn = document.getElementById('printBtn');

        // Event listeners
        attackDescription.addEventListener('input', handleTextChange);
        analyzeBtn.addEventListener('click', analyzeText);
        exampleBtn.addEventListener('click', loadExample);
        clearBtn.addEventListener('click', clearText);
        copyJsonBtn.addEventListener('click', copyToClipboard);
        downloadJsonBtn.addEventListener('click', downloadJson);
        printBtn.addEventListener('click', printReport);

        // Handle text input changes
        function handleTextChange() {
            const text = attackDescription.value;
            charCount.textContent = text.length;
            
            // Enable/disable analyze button
            analyzeBtn.disabled = text.trim().length === 0;
            
            // Real-time analysis for better UX
            if (text.trim().length > 10) {
                debounce(analyzeText, 1000)();
            }
        }

        // Debounce function for performance
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Analyze text and map to techniques
        function analyzeText() {
            if (isAnalyzing) return;
            
            const text = attackDescription.value.trim().toLowerCase();
            if (!text) {
                showNoResults();
                return;
            }

            isAnalyzing = true;
            showLoading();
            
            // Simulate processing time for better UX
            setTimeout(() => {
                const results = mapTextToTechniques(text);
                currentResults = results;
                displayResults(results);
                updateExportButtons(results.length > 0);
                isAnalyzing = false;
            }, 500);
        }

        // Map text to MITRE ATT&CK techniques
        function mapTextToTechniques(text) {
            const results = [];
            
            attackTechniques.forEach(technique => {
                let score = 0;
                let matchedKeywords = [];
                
                technique.keywords.forEach(keyword => {
                    if (text.includes(keyword.toLowerCase())) {
                        // Higher score for exact matches
                        const occurrences = (text.match(new RegExp(keyword.toLowerCase(), 'g')) || []).length;
                        score += occurrences * (keyword.length > 3 ? 2 : 1);
                        matchedKeywords.push(keyword);
                    }
                });
                
                if (score > 0) {
                    // Calculate confidence percentage
                    const confidence = Math.min(95, Math.max(60, score * 15));
                    
                    results.push({
                        ...technique,
                        confidence: Math.round(confidence),
                        matchedKeywords: matchedKeywords,
                        score: score
                    });
                }
            });
            
            // Sort by confidence score (descending)
            return results.sort((a, b) => b.confidence - a.confidence);
        }

        // Display results in the UI
        function displayResults(results) {
            if (results.length === 0) {
                showNoResults();
                return;
            }

            resultsCount.textContent = `${results.length} result${results.length === 1 ? '' : 's'}`;
            
            const html = results.map((technique, index) => {
                const confidenceClass = technique.confidence >= 80 ? 'confidence-high' :
                                      technique.confidence >= 65 ? 'confidence-medium' : 'confidence-low';
                
                return `
                    <div class="technique-card" style="animation-delay: ${index * 0.1}s">
                        <div class="technique-header">
                            <span class="technique-id">${technique.id}</span>
                            <span class="confidence-score ${confidenceClass}">${technique.confidence}% match</span>
                        </div>
                        <div class="technique-name">${technique.name}</div>
                        <div class="technique-tactic">Tactic: ${technique.tactic}</div>
                        <div class="technique-description">${technique.description}</div>
                        ${technique.matchedKeywords.length > 0 ? 
                            `<div style="margin-top: 10px; font-size: 12px; color: #a0aec0;">
                                <strong>Matched keywords:</strong> ${technique.matchedKeywords.join(', ')}
                            </div>` : ''
                        }
                    </div>
                `;
            }).join('');
            
            resultsContainer.innerHTML = html;
        }

        // Show loading state
        function showLoading() {
            resultsContainer.innerHTML = '<div class="spinner"></div>';
            resultsCount.textContent = 'Analyzing...';
        }

        // Show no results state
        function showNoResults() {
            resultsContainer.innerHTML = `
                <div class="no-results">
                    <div class="icon">üîç</div>
                    <p>No techniques found. Try describing specific attack methods, tools, or behaviors.</p>
                </div>
            `;
            resultsCount.textContent = '0 results';
            currentResults = [];
            updateExportButtons(false);
        }

        // Load example text
        function loadExample() {
            const examples = [
                "The attacker used PowerShell to download a malicious payload from a C2 server, then established persistence through a scheduled task and harvested credentials using Mimikatz.",
                "Spearphishing email with malicious document attachment led to code execution. The malware performed system discovery using systeminfo and whoami commands, then moved laterally via RDP.",
                "Adversary exploited public-facing web application vulnerability, deployed web shell, and used it to execute commands and exfiltrate sensitive data over HTTPS.",
                "Ransomware deployed via compromised RDP credentials. Files were encrypted for impact after credential harvesting and lateral movement through SMB shares."
            ];
            
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            attackDescription.value = randomExample;
            handleTextChange();
            analyzeText();
        }

        // Clear text and results
        function clearText() {
            attackDescription.value = '';
            handleTextChange();
            showNoResults();
        }

        // Copy results to clipboard as JSON
        async function copyToClipboard() {
            try {
                const json = JSON.stringify(currentResults, null, 2);
                await navigator.clipboard.writeText(json);
                
                // Visual feedback
                const originalText = copyJsonBtn.textContent;
                copyJsonBtn.textContent = '‚úÖ Copied!';
                setTimeout(() => {
                    copyJsonBtn.textContent = originalText;
                }, 2000);
            } catch (err) {
                console.error('Failed to copy: ', err);
                alert('Failed to copy to clipboard');
            }
        }

        // Download results as JSON file
        function downloadJson() {
            const json = JSON.stringify(currentResults, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `mitre-attack-analysis-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Print report
        function printReport() {
            const printWindow = window.open('', '_blank');
            const printContent = generatePrintReport();
            
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.print();
        }

        // Generate HTML for print report
        function generatePrintReport() {
            const timestamp = new Date().toLocaleString();
            
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>MITRE ATT&CK Analysis Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 20px; }
                        .technique { border: 1px solid #ccc; margin: 10px 0; padding: 15px; }
                        .technique-id { background: #f0f0f0; padding: 5px; font-family: monospace; }
                        .confidence { font-weight: bold; color: #0066cc; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>MITRE ATT&CK Analysis Report</h1>
                        <p><strong>Generated:</strong> ${timestamp}</p>
                        <p><strong>Input:</strong> ${attackDescription.value}</p>
                        <p><strong>Results:</strong> ${currentResults.length} techniques identified</p>
                    </div>
                    
                    ${currentResults.map(technique => `
                        <div class="technique">
                            <h3>${technique.name} <span class="technique-id">${technique.id}</span></h3>
                            <p><strong>Tactic:</strong> ${technique.tactic}</p>
                            <p><strong>Confidence:</strong> <span class="confidence">${technique.confidence}%</span></p>
                            <p><strong>Description:</strong> ${technique.description}</p>
                            ${technique.matchedKeywords.length > 0 ? 
                                `<p><strong>Matched Keywords:</strong> ${technique.matchedKeywords.join(', ')}</p>` : ''
                            }
                        </div>
                    `).join('')}
                </body>
                </html>
            `;
        }

        // Update export button states
        function updateExportButtons(enabled) {
            copyJsonBtn.disabled = !enabled;
            downloadJsonBtn.disabled = !enabled;
            printBtn.disabled = !enabled;
        }

        // Initialize the application
        function init() {
            // Set initial state
            handleTextChange();
            showNoResults();
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Ctrl+Enter to analyze
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    analyzeText();
                }
                
                // Ctrl+L to load example
                if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
                    e.preventDefault();
                    loadExample();
                }
                
                // Escape to clear
                if (e.key === 'Escape') {
                    clearText();
                }
            });
            
            console.log('MITRE ATT&CK Technique Mapper initialized');
        }

        // Start the application when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>